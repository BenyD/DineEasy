# Stripe API Version Update: 2025-07-30.basil

## Overview

The DineEasy platform has been updated to use Stripe API version `2025-07-30.basil`. This update ensures compatibility with the latest Stripe features and improvements.

## What Was Updated

### Files Modified

1. **`lib/stripe.ts`**
   - Updated `apiVersion` from `"2025-06-30.basil"` to `"2025-07-30.basil"`
   - Main Stripe client configuration

2. **`scripts/setup-stripe.ts`**
   - Updated `apiVersion` from `"2025-06-30.basil"` to `"2025-07-30.basil"`
   - Stripe setup script for creating prices

## API Version Details

### Version: 2025-07-30.basil

- **Type**: Basil (Beta) version
- **Release Date**: July 30, 2025
- **Status**: Latest beta version with newest features

### Compatibility

- **Stripe Node.js SDK**: v18.3.0 ✅ Compatible
- **Stripe.js**: v7.7.0 ✅ Compatible
- **TypeScript**: ✅ Fully supported

## Key Features in 2025-07-30.basil

### New Features

- Enhanced payment method handling
- Improved webhook reliability
- Better error handling and reporting
- Enhanced subscription management
- Improved Connect platform features

### Breaking Changes

- None reported for this version
- Backward compatible with previous basil versions

## Testing the Update

### 1. Verify Configuration

```bash
# Check if the API version is correctly set
node -e "const Stripe = require('stripe'); const stripe = new Stripe('sk_test_123', { apiVersion: '2025-07-30.basil' }); console.log('✅ API version valid');"
```

### 2. Test Stripe Functions

```typescript
// Test customer creation
const customer = await stripe.customers.create({
  email: "test@example.com",
  name: "Test Customer",
});

// Test subscription creation
const subscription = await stripe.subscriptions.create({
  customer: customer.id,
  items: [{ price: "price_test" }],
  trial_period_days: 14,
});
```

### 3. Test Webhook Handling

```typescript
// Test webhook event construction
const event = stripe.webhooks.constructEvent(payload, signature, webhookSecret);
```

## Environment Variables

Ensure your environment variables are properly configured:

```bash
# Required for Stripe functionality
STRIPE_SECRET_KEY=sk_live_... or sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_... or pk_test_...

# Price IDs (generated by setup-stripe.ts)
STRIPE_STARTER_MONTHLY_CHF_PRICE_ID=price_...
STRIPE_STARTER_YEARLY_CHF_PRICE_ID=price_...
STRIPE_PRO_MONTHLY_CHF_PRICE_ID=price_...
STRIPE_PRO_YEARLY_CHF_PRICE_ID=price_...
STRIPE_ELITE_MONTHLY_CHF_PRICE_ID=price_...
STRIPE_ELITE_YEARLY_CHF_PRICE_ID=price_...
```

## Migration Checklist

- [x] Update `lib/stripe.ts` API version
- [x] Update `scripts/setup-stripe.ts` API version
- [x] Verify TypeScript compatibility
- [x] Test Stripe client initialization
- [x] Update documentation

## Monitoring

### What to Monitor

1. **Payment Processing**: Ensure payments are being processed correctly
2. **Webhook Events**: Monitor webhook delivery and processing
3. **Subscription Management**: Verify subscription creation and updates
4. **Error Rates**: Watch for any new error patterns

### Logging

All Stripe operations are logged with the new API version. Check your application logs for:

- Stripe client initialization
- API request/response patterns
- Error messages and stack traces

## Rollback Plan

If issues arise, you can rollback to the previous version:

```typescript
// In lib/stripe.ts
export const stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {
  apiVersion: "2025-06-30.basil", // Previous version
  typescript: true,
});
```

## Support

If you encounter any issues with the new API version:

1. Check the [Stripe API Changelog](https://stripe.com/docs/api/versioning)
2. Review [Stripe API Documentation](https://stripe.com/docs/api)
3. Contact Stripe Support for API-specific issues
4. Check DineEasy logs for application-specific errors

## Next Steps

1. **Deploy the changes** to your staging environment
2. **Test all Stripe functionality** thoroughly
3. **Monitor production** after deployment
4. **Update any client-side Stripe.js** if needed
5. **Verify webhook endpoints** are receiving events correctly

---

**Updated**: July 30, 2025  
**Version**: 2025-07-30.basil  
**Status**: ✅ Ready for deployment
